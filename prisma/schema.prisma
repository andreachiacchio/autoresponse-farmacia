// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "sqlite"
  url       = env("DATABASE_URL")
}

// Configurazione API Trustpilot
model TrustpilotConfig {
  id                String   @id @default(cuid())
  apiKey            String
  apiSecret         String
  businessUnitId    String?
  accessToken       String?
  refreshToken      String?
  tokenExpiresAt    DateTime?
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// Template di risposta automatica
model ResponseTemplate {
  id                String   @id @default(cuid())
  name              String
  description       String?
  minRating         Int      @default(1)
  maxRating         Int      @default(5)
  customInstruction String?
  tone              String   @default("professionale")
  isActive          Boolean  @default(true)
  isDefault         Boolean  @default(false)
  priority          Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  responses         AutoResponseLog[]
}

// Recensioni lette da Trustpilot
model Review {
  id                String   @id @default(cuid())
  trustpilotId      String   @unique
  businessUnitId    String?
  authorName        String?
  authorId          String?
  title             String?
  text              String?
  rating            Int
  language          String?
  status            String   @default("active")
  isVerified        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  trustpilotCreatedAt DateTime?
  respondedAt       DateTime?
  response          AutoResponseLog?
}

// Log delle risposte automatiche
model AutoResponseLog {
  id                String   @id @default(cuid())
  reviewId          String   @unique
  review            Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  templateId        String?
  template          ResponseTemplate? @relation(fields: [templateId], references: [id])
  generatedResponse String
  status            String   @default("pending")
  sentAt            DateTime?
  errorMessage      String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// Impostazioni dell'applicazione
model AppSetting {
  id                String   @id @default(cuid())
  key               String   @unique
  value             String
  description       String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// Cron job log
model CronJobLog {
  id                String   @id @default(cuid())
  jobName           String
  status            String
  startedAt         DateTime @default(now())
  completedAt       DateTime?
  reviewsProcessed  Int      @default(0)
  responsesSent     Int      @default(0)
  errorMessage      String?
}
